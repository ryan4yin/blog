<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>SQL 基础笔记（一） - This Cute World</title><meta name=Description content="This Cute World"><meta property="og:title" content="SQL 基础笔记（一）"><meta property="og:description" content="本笔记整理自《SQL 基础教程》、《MySQL 必知必会》和网上资料。个人笔记不保证正确。 一、基础SQL，即结构化查询语言，是为访问与操作关系数"><meta property="og:type" content="article"><meta property="og:url" content="https://thiscute.world/posts/sql-basics-1/"><meta property="og:image" content="https://thiscute.world/posts/sql-basics-1/sql.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-15T16:27:46+08:00"><meta property="article:modified_time" content="2018-06-15T16:27:46+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://thiscute.world/posts/sql-basics-1/sql.webp"><meta name=twitter:title content="SQL 基础笔记（一）"><meta name=twitter:description content="本笔记整理自《SQL 基础教程》、《MySQL 必知必会》和网上资料。个人笔记不保证正确。 一、基础SQL，即结构化查询语言，是为访问与操作关系数"><meta name=application-name content="This Cute World"><meta name=apple-mobile-web-app-title content="This Cute World"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://thiscute.world/posts/sql-basics-1/><link rel=prev href=https://thiscute.world/posts/video2chars-2/><link rel=next href=https://thiscute.world/posts/sql-basics-2-queries/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="E8bpp1lVVlb9YnSJcUzPL1dLAG17Nl_sp5Ru9a8tUDQ"><meta name=baidu-site-verification content="code-ZZtDruAnX1"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"SQL 基础笔记（一）","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/thiscute.world\/posts\/sql-basics-1\/"},"image":[{"@type":"ImageObject","url":"https:\/\/thiscute.world\/posts\/sql-basics-1\/sql.webp","width":789,"height":340}],"genre":"posts","keywords":"SQL, 数据库, Database","wordcount":4443,"url":"https:\/\/thiscute.world\/posts\/sql-basics-1\/","datePublished":"2018-06-15T16:27:46+08:00","dateModified":"2018-06-15T16:27:46+08:00","publisher":{"@type":"Organization","name":"ryan4yin","logo":"https:\/\/thiscute.world\/avatar\/myself.png"},"author":{"@type":"Person","name":"ryan4yin"},"description":""}</script><script src=//instant.page/5.2.0 defer type=module integrity=sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z></script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="This Cute World"><span id=desktop-header-typeit class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/statistics/>阅读排行 </a><a class=menu-item href=/series/>系列 </a><a class=menu-item href=/categories/tech/>技术 </a><a class=menu-item href=/categories/life/>生活 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/friends/>朋友们 </a><a class=menu-item href=/now/>此刻 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>Simplified Chinese<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title=选择语言 id=language-select-desktop onchange="location=this.value"><option value=/posts/sql-basics-1/ selected>Simplified Chinese</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="This Cute World"><span id=mobile-header-typeit class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/statistics/ title>阅读排行</a><a class=menu-item href=/series/ title>系列</a><a class=menu-item href=/categories/tech/ title>技术</a><a class=menu-item href=/categories/life/ title>生活</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/friends/ title>朋友们</a><a class=menu-item href=/now/ title>此刻</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言>Simplified Chinese<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title=选择语言 onchange="location=this.value"><option value=/posts/sql-basics-1/ selected>Simplified Chinese</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#一基础>一、基础</a></li><li><a href=#二ddl>二、DDL</a><ul><li><a href=#1-数据库的创建和删除>1. 数据库的创建和删除</a></li><li><a href=#2-创建表>2. 创建表：</a><ul><li><a href=#关系表的设计>关系表的设计</a></li><li><a href=#语句>语句：</a></li><li><a href=#字段类型mysql>字段类型（MySQL）</a></li><li><a href=#约束>约束</a></li></ul></li><li><a href=#3-删除表和更新表定义>3. 删除表和更新表定义</a></li></ul></li><li><a href=#三dml>三、DML</a><ul><li><a href=#1-查询重点>1. 查询（重点）</a></li><li><a href=#2-聚合与排序重点>2. 聚合与排序（重点）</a><ul><li><a href=#聚合函数>聚合函数</a></li><li><a href=#分组group-by>分组(GROUP BY)</a></li><li><a href=#聚合对select子句的限制>聚合对SELECT子句的限制</a></li><li><a href=#对聚合结果进行过滤having>对聚合结果进行过滤(HAVING)</a></li><li><a href=#排序order-by>排序(ORDER BY)</a></li></ul></li><li><a href=#3-数据的增删改>3. 数据的增、删、改</a><ul><li><a href=#插入insert-into-也算用的多了>插入(INSERT INTO) 也算用的多了</a></li><li><a href=#删除delete>删除(DELETE)</a></li><li><a href=#更新update>更新(UPDATE)</a></li></ul></li></ul></li><li><a href=#四dcl---事务处理mysql>四、DCL - 事务处理(MySQL)</a><ul><li><a href=#数据何时被提交到数据库>数据何时被提交到数据库</a></li></ul></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">SQL 基础笔记（一）</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=https://thiscute.world/ title=Author target=_blank rel="noopener noreferrer author" class=author>ryan4yin</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/tech/><i class="far fa-folder fa-fw"></i>tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-06-15>2018-06-15</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2018-06-15>2018-06-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4443 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;</div></div><div class=featured-image><img loading=eager src=/posts/sql-basics-1/sql.webp srcset="/posts/sql-basics-1/sql.webp, /posts/sql-basics-1/sql.webp 1.5x, /posts/sql-basics-1/sql.webp 2x" sizes=auto alt=/posts/sql-basics-1/sql.webp title=/posts/sql-basics-1/sql.webp height=340 width=789></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#一基础>一、基础</a></li><li><a href=#二ddl>二、DDL</a><ul><li><a href=#1-数据库的创建和删除>1. 数据库的创建和删除</a></li><li><a href=#2-创建表>2. 创建表：</a><ul><li><a href=#关系表的设计>关系表的设计</a></li><li><a href=#语句>语句：</a></li><li><a href=#字段类型mysql>字段类型（MySQL）</a></li><li><a href=#约束>约束</a></li></ul></li><li><a href=#3-删除表和更新表定义>3. 删除表和更新表定义</a></li></ul></li><li><a href=#三dml>三、DML</a><ul><li><a href=#1-查询重点>1. 查询（重点）</a></li><li><a href=#2-聚合与排序重点>2. 聚合与排序（重点）</a><ul><li><a href=#聚合函数>聚合函数</a></li><li><a href=#分组group-by>分组(GROUP BY)</a></li><li><a href=#聚合对select子句的限制>聚合对SELECT子句的限制</a></li><li><a href=#对聚合结果进行过滤having>对聚合结果进行过滤(HAVING)</a></li><li><a href=#排序order-by>排序(ORDER BY)</a></li></ul></li><li><a href=#3-数据的增删改>3. 数据的增、删、改</a><ul><li><a href=#插入insert-into-也算用的多了>插入(INSERT INTO) 也算用的多了</a></li><li><a href=#删除delete>删除(DELETE)</a></li><li><a href=#更新update>更新(UPDATE)</a></li></ul></li></ul></li><li><a href=#四dcl---事务处理mysql>四、DCL - 事务处理(MySQL)</a><ul><li><a href=#数据何时被提交到数据库>数据何时被提交到数据库</a></li></ul></li></ul></nav></div></div><div class=content id=content><blockquote><p>本笔记整理自<a href=https://book.douban.com/subject/24841239/ target=_blank rel="noopener noreferrer">《SQL 基础教程》</a>、<a href=https://book.douban.com/subject/3354490/ target=_blank rel="noopener noreferrer">《MySQL 必知必会》</a>和网上资料。个人笔记不保证正确。</p></blockquote><h2 id=一基础 class=headerLink><a href=#%e4%b8%80%e5%9f%ba%e7%a1%80 class=header-mark></a>一、基础</h2><p>SQL，即结构化查询语言，是为访问与操作关系数据库中的数据而设计的语言。</p><ol><li>关系数据库以行(row)为单位读写数据</li><li>SQL 根据功能的不同，可分为三类（其中DML用得最多，增删查改嘛）<ol><li>DDL(Data Definition Language, 数据定义语言): CREATE/DROP/ALTER</li><li>DML(Data Manipulation Language, 数据操作语言): SELECT/INSERT/UPDATE/DELETE</li><li>DCL(Data Control Language, 数据控制语言): COMMIT/ROLLBACK/GRANT/REVOKE</li></ol></li><li>SQL 语句要以分号结尾。换行在 SQL 中不表示结束，而等同于空格。</li><li>SQL 不区分**关键字(Keyword)**的大小写，但是描述符就不一定了。<ul><li>这里有个坑：MySQL 中，数据库和表其实就是数据目录下的目录和文件，因而，<strong>操作系统的敏感性决定数据库名和表名 是否大小写敏感</strong>。这就意味着<strong>数据库名</strong>和<strong>表名</strong>在 Windows 中是大小写不敏感的，而在大多数类型的 Unix/Linux 系统中是大小写敏感的。（注意仅指数据库名和表名）可通过修改配置文件的<code>lower_case_table_names</code>属性来统一这一行为。</li><li>而<strong>字段名</strong>、<strong>字段内容</strong>都是内部数据，是操作系统无关的。它们的大小写敏感性，由 MySQL 的的校对（COLLATE）规则来控制。该规则体现在 MySQL 的 校对字符集（COLLATION）的后缀上：比如 utf8字符集，<code>utf8_general_ci</code>表示不区分大小写，这个是 utf8 字符集默认的校对规则；<code>utf8_general_cs</code> 表示区分大小写，<code>utf8_bin</code> 表示二进制比较，同样也区分大小写 。</li></ul></li><li>SQL 中的字符串和日期需要用单引号引用起来，日期有特定格式<code>年-月-日</code></li></ol><p>修改字符集：<code>set names &lt;字符集名></code>
记住在 MySQL 中，utf-8mb4 才是完全的 utf-8字符集。</p><h2 id=二ddl class=headerLink><a href=#%e4%ba%8cddl class=header-mark></a>二、DDL</h2><h3 id=1-数据库的创建和删除 class=headerLink><a href=#1-%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%88%9b%e5%bb%ba%e5%92%8c%e5%88%a0%e9%99%a4 class=header-mark></a>1. 数据库的创建和删除</h3><ol><li>创建数据库</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=o>&lt;</span><span class=err>数据库名称</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=o>&lt;</span><span class=err>数据库名称</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-创建表 class=headerLink><a href=#2-%e5%88%9b%e5%bb%ba%e8%a1%a8 class=header-mark></a>2. 创建表：</h3><h4 id=关系表的设计 class=headerLink><a href=#%e5%85%b3%e7%b3%bb%e8%a1%a8%e7%9a%84%e8%ae%be%e8%ae%a1 class=header-mark></a>关系表的设计</h4><p>关系表的设计，要确保把信息分解成多个表，一类信息一个表，各表通过某些常用的，基本不会改变的值（即关系表设计中的关系，也常称为外键）互相关联。尽量不要有冗余数据。</p><h4 id=语句 class=headerLink><a href=#%e8%af%ad%e5%8f%a5 class=header-mark></a>语句：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>1</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>数据类型</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>该列所需约束</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>2</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>数据类型</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>该列所需约束</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>3</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>数据类型</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>该列所需约束</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=err>该表的约束</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=err>该表的约束</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>举例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>persons</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=n>UNSIGNED</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=w> </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>后面的是设置引擎和默认字符集。工作上，表的设计一定要深思熟虑，因为改起来很困难。</p><h4 id=字段类型mysql class=headerLink><a href=#%e5%ad%97%e6%ae%b5%e7%b1%bb%e5%9e%8bmysql class=header-mark></a>字段类型（MySQL）</h4><p>有四类数据类型：字符串、数字、日期、二进制。它们又根据数据长度的区别，下分为多个类型。</p><ol><li>字符串：<figure><a class=lightgallery href=/images/sql-basic/968138-20180615170308408-1360197489.webp title="string types" data-thumbnail=/images/sql-basic/968138-20180615170308408-1360197489.webp><img loading=lazy src=/images/sql-basic/968138-20180615170308408-1360197489.webp srcset="/images/sql-basic/968138-20180615170308408-1360197489.webp, /images/sql-basic/968138-20180615170308408-1360197489.webp 1.5x, /images/sql-basic/968138-20180615170308408-1360197489.webp 2x" sizes=auto alt="string types"></a></figure></li><li>数字<figure><a class=lightgallery href=/images/sql-basic/968138-20180615170501735-1087517507.webp title="numeric types" data-thumbnail=/images/sql-basic/968138-20180615170501735-1087517507.webp><img loading=lazy src=/images/sql-basic/968138-20180615170501735-1087517507.webp srcset="/images/sql-basic/968138-20180615170501735-1087517507.webp, /images/sql-basic/968138-20180615170501735-1087517507.webp 1.5x, /images/sql-basic/968138-20180615170501735-1087517507.webp 2x" sizes=auto alt="numeric types"></a></figure></li><li>日期<figure><a class=lightgallery href=/images/sql-basic/968138-20180615170610668-439886214.webp title="date types" data-thumbnail=/images/sql-basic/968138-20180615170610668-439886214.webp><img loading=lazy src=/images/sql-basic/968138-20180615170610668-439886214.webp srcset="/images/sql-basic/968138-20180615170610668-439886214.webp, /images/sql-basic/968138-20180615170610668-439886214.webp 1.5x, /images/sql-basic/968138-20180615170610668-439886214.webp 2x" sizes=auto alt="date types"></a></figure></li><li>二进制<figure><a class=lightgallery href=/images/sql-basic/968138-20180615170949680-176119067.webp title="binary types" data-thumbnail=/images/sql-basic/968138-20180615170949680-176119067.webp><img loading=lazy src=/images/sql-basic/968138-20180615170949680-176119067.webp srcset="/images/sql-basic/968138-20180615170949680-176119067.webp, /images/sql-basic/968138-20180615170949680-176119067.webp 1.5x, /images/sql-basic/968138-20180615170949680-176119067.webp 2x" sizes=auto alt="binary types"></a></figure></li></ol><h4 id=约束 class=headerLink><a href=#%e7%ba%a6%e6%9d%9f class=header-mark></a>约束</h4><p>SQL 约束是除了数据类型之外，对列中数据追加的限定条件。</p><ol><li>类型约束：<code>NOT NULL</code>、<code>AUTO_INCREMENT</code>、<code>UNSIGNED</code>（这个只 MySQL 支持）</li><li>默认值：<code>DEFAULT</code>，举例 <code>&lt;列名3> VARCHAR(32) NOT NULL DEFAULT "los angeles"</code></li><li>表约束：<code>PRIMARY KEY</code> 主键约束（主键默认 UNIQUE 且 NOT NULL）</li></ol><p>此外还有 <code>FOREIGN KEY</code> 和 <code>CHECK</code> 两个约束语句，在<a href=https://www.cnblogs.com/kirito-c/p/10295693.html target=_blank rel="noopener noreferrer">进阶笔记</a>中介绍。</p><blockquote><p>P.S. 字段约束也可以写成表约束（比如主键约束），而反过来很可能不行。</p></blockquote><h3 id=3-删除表和更新表定义 class=headerLink><a href=#3-%e5%88%a0%e9%99%a4%e8%a1%a8%e5%92%8c%e6%9b%b4%e6%96%b0%e8%a1%a8%e5%ae%9a%e4%b9%89 class=header-mark></a>3. 删除表和更新表定义</h3><ol><li>删除表（危险操作）<ul><li>删除整个表：</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><pre><code>- 只清空表内数据，但留下表：
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>TRUNCATE</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 非标准SQL语句，但是大部分DB都支持。（可能不能ROLLBACK）
</span></span></span></code></pre></td></tr></table></div></div><ol start=2><li>更新表定义（麻烦的操作）
所以所创建表前要仔细想好格式了，更新表定义是不得已才能为之。
添加列定义：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>数据类型</span><span class=o>&gt;</span><span class=w> </span><span class=o>&lt;</span><span class=err>该列的约束</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>删除列定义：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=三dml class=headerLink><a href=#%e4%b8%89dml class=header-mark></a>三、DML</h2><blockquote><p>万恶之源 NULL</p></blockquote><h3 id=1-查询重点 class=headerLink><a href=#1-%e6%9f%a5%e8%af%a2%e9%87%8d%e7%82%b9 class=header-mark></a>1. 查询（重点）</h3><ol><li>基本语句：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT &lt;字段1&gt; AS &lt;别名1&gt;,
</span></span><span class=line><span class=cl>     &lt;字段2&gt; AS &lt;别名2&gt;,
</span></span><span class=line><span class=cl>     ...
</span></span><span class=line><span class=cl>FROM &lt;表名&gt;
</span></span><span class=line><span class=cl>WHERE &lt;过滤条件&gt;;
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>可<strong>用 <code>DISTINCT</code> 修饰列名</strong>，使查询结果无重。例：<code>SELECT DISTINCT &lt;列名> FROM &lt;表名></code></li><li>过滤条件可使用比较运算(&lt;>、=等)和逻辑运算(AND OR NOT).</li><li>过滤条件中，<strong>比较运算会永远忽略 NULL 值</strong>，如果需要对 NULL 值做操作，需要使用 <strong>IS NULL</strong> 或 <strong>IS NOT NULL</strong>（说忽略也许不太准确，NULL 既不为真也不为假，反正少用NULL。。）</li><li>包含NULL的四则运算，得到的结果总为NULL</li></ol><h3 id=2-聚合与排序重点 class=headerLink><a href=#2-%e8%81%9a%e5%90%88%e4%b8%8e%e6%8e%92%e5%ba%8f%e9%87%8d%e7%82%b9 class=header-mark></a>2. 聚合与排序（重点）</h3><h4 id=聚合函数 class=headerLink><a href=#%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0 class=header-mark></a>聚合函数</h4><p>即对列进行统计分析的函数，主要有五个：</p><ol><li>COUNT：计算列的行数。（只有<code>COUNT(*)</code>会计算NULL行）</li><li>SUM：求该列之和。</li><li>AVG：求该列的平均值。</li><li>MAX/MIN：求该列的 最大/最小 值</li></ol><p>NOTE：</p><ol><li><strong>聚合函数计算时会排除所有NULL行。只有COUNT(*)例外，NULL行也会被它计数</strong>。</li><li>MAX/MIN 几乎适用于所有数据类型的列（对非数值型，以其二进制值来排序），而SUM/AVG只能用于数值类型的列。</li><li>聚合函数操作的列，也能用DISTINCT修饰。例：<code>SELECT COUNT(DISTINCT &lt;列名>) FROM &lt;表名></code></li><li>聚合函数只能用于SELECT子句和还没讲的HAVING子句（以及 ORDER BY 子句）中。</li></ol><h4 id=分组group-by class=headerLink><a href=#%e5%88%86%e7%bb%84group-by class=header-mark></a>分组(GROUP BY)</h4><p>分组以聚合键为分类标准，将数据分为多个逻辑组，从而能分别对每个组进行聚合运算。（分组是为了分类聚合）</p><ol><li>若出现了 GROUP BY 子句，查询结果一定是每一组一行。</li><li>GROUP BY 会将 NULL 作为一组特定数据，显示为空。</li></ol><h4 id=聚合对select子句的限制 class=headerLink><a href=#%e8%81%9a%e5%90%88%e5%af%b9select%e5%ad%90%e5%8f%a5%e7%9a%84%e9%99%90%e5%88%b6 class=header-mark></a>聚合对SELECT子句的限制</h4><p>首先要理解的是：</p><ol><li>聚合函数的操作对象为某一列，而产生的结果只有一个值。</li><li>GROUP BY 的操作对象为一列或者多列，产生的结果呢，是每一组一个值。</li></ol><p>因此为了避免歧义，只要使用了聚合函数或 GROUP BY 二者之一，SELECT 子句就只能包含：</p><ol><li>常数</li><li>其他聚合函数（该聚合函数的操作对象可以为其他列）</li><li>如果使用了 GROUP BY 子句，还能包括该子句所指定的列名。（也就是聚合键）但是<strong>绝不能包含其他的列名</strong>，因为这会有歧义。</li></ol><p>此外，还有一个问题是由 SQL 的执行顺序引起的。应该能很容易猜到，<strong>SELECT 语句的执行顺序和书写顺序是不一致的</strong>。
查询应该是从表开始，所以 FROM 语句一定先执行。然后应该要过滤(WHERE)，再是分组(GROUP BY)，最后才是 SELECT 语句。（就已经学到的子句而言，顺序是这样）
因此按理说，<strong>SELECT 语句 定义的别名，是不能在 GROUP BY 里使用的</strong>。（也有些DB支持该用法，但不通用）</p><h4 id=对聚合结果进行过滤having class=headerLink><a href=#%e5%af%b9%e8%81%9a%e5%90%88%e7%bb%93%e6%9e%9c%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4having class=header-mark></a>对聚合结果进行过滤(HAVING)</h4><p>从刚刚说过的SQL执行顺序可见，WHERE要比GROUP BY先执行，因此如果想过滤分组后的结果，不能用它。而应该使用 HAVING 子句。
HAVING 子句和 WHERE 子句都是用来过滤的，但是执行顺序的不同也就决定了它们的用途不同。</p><p>NOTE：</p><ol><li>有时候，会发现某个过滤条件，不论是先执行（就是写在WHERE子句中）还是后执行（写在HAVING中）都没问题，这时候应该将它写在WHERE子句中，这样GROUP BY操作的数据会更少，处理更快。</li><li>HAVING 子句的元素，也存在和 SELECT 子句同样的限制。不能使用聚合键以外的列名。</li></ol><h4 id=排序order-by class=headerLink><a href=#%e6%8e%92%e5%ba%8forder-by class=header-mark></a>排序(ORDER BY)</h4><p><strong>ORDER BY 子句在 SELECT 子句之后执行</strong>，因此它能使用 SELECT 子句中定义的别名。（而 GROUP BY 之前已经说过不能用别名了）
格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>&lt;</span><span class=err>字段</span><span class=mi>1</span><span class=o>&gt;</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=o>&lt;</span><span class=err>别名</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=o>&lt;</span><span class=err>字段</span><span class=mi>2</span><span class=o>&gt;</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=o>&lt;</span><span class=err>别名</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=o>&lt;</span><span class=err>过滤条件</span><span class=mi>1</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> </span><span class=o>&lt;</span><span class=err>过滤条件</span><span class=mi>2</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=o>/</span><span class=err>别名</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=o>/</span><span class=err>别名</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>...</span><span class=w>  </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li>多排序键/列：指定多排序键时的排序规则为：<strong>优先使用左侧的列，如果该列存在相同值，再接着参考右侧的键，依此类推</strong>。（如果左侧键值不同，右侧的键就不会被使用了）</li><li>NULL 值的顺序：<strong>排序键中出现了 NULL 值时，这类值会在结果的开头或结尾汇总</strong>，究竟是排在开头还是结尾，并没有特殊规定。</li><li>ORDER BY 子句只影响结果的先后顺序，因此排序键可以是结果集以外的东西，比如其他的列，或者使用了 GROUP BY 时，还能用聚合函数。</li></ol><h3 id=3-数据的增删改 class=headerLink><a href=#3-%e6%95%b0%e6%8d%ae%e7%9a%84%e5%a2%9e%e5%88%a0%e6%94%b9 class=header-mark></a>3. 数据的增、删、改</h3><h4 id=插入insert-into-也算用的多了 class=headerLink><a href=#%e6%8f%92%e5%85%a5insert-into-%e4%b9%9f%e7%ae%97%e7%94%a8%e7%9a%84%e5%a4%9a%e4%ba%86 class=header-mark></a>插入(INSERT INTO) 也算用的多了</h4><p>语法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=err>列名</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=err>列名</span><span class=mi>2</span><span class=p>...)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=err>值</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=err>值</span><span class=mi>2</span><span class=p>...);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>或者也可以使用 SELECT 语句来替代 VALUES 子句，达到将 SELECT 到的结果集插入某表的效果。（但是不要用ORDER BY，因为结果是<strong>集</strong>，没有顺序，排序是徒劳无功的）
插入时主键不能重复，否则会报错。（因此如果需要包含重复数据，一般都会定义一个自增的id字段）</p><h4 id=删除delete class=headerLink><a href=#%e5%88%a0%e9%99%a4delete class=header-mark></a>删除(DELETE)</h4><p>清空表（危险操作，而且效率不如 TRUNCATE）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>条件删除：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=o>&lt;</span><span class=err>条件</span><span class=o>&gt;</span><span class=p>;</span><span class=w> 
</span></span></span></code></pre></td></tr></table></div></div><p>因此使用DELETE时，一定要记得带WHERE，不然就好玩了。。</p><h4 id=更新update class=headerLink><a href=#%e6%9b%b4%e6%96%b0update class=header-mark></a>更新(UPDATE)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>1</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;</span><span class=err>算术表达式</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>&lt;</span><span class=err>列名</span><span class=mi>2</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;</span><span class=err>表达式</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=o>&lt;</span><span class=err>条件</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>同 DELETE 一样，不带 WHERE 子句的 UPDATE 是很危险的。</p><h2 id=四dcl---事务处理mysql class=headerLink><a href=#%e5%9b%9bdcl---%e4%ba%8b%e5%8a%a1%e5%a4%84%e7%90%86mysql class=header-mark></a>四、DCL - 事务处理(MySQL)</h2><p><strong>事务是一系列不可分割的数据库操作</strong>，也就是说，这一系列操作要么全部执行，要么全部不执行。如果执行过程中发生了问题（检查执行状态），可以通过执行 ROLLBACK 回滚到该事务执行前的状态。（<strong>注意并不会自动回滚</strong>）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>START</span><span class=w> </span><span class=n>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- do somthing
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>START TRANSACTION</code>: 标识事务的开始</li><li><code>COMMIT</code>：提交事务。一旦提交，所执行过的操作就已成定论，恢复不了了。</li><li><code>ROLLBACK</code>：事务回滚，<strong>只能回滚未 COMMIT 的 DML 操作</strong>！也就是说只能用在 <code>START TRANSACTION</code> 和 <code>COMMIT</code> 之间，并且只能回滚 <code>INSERT/UPDATE/DELETE</code>。（回滚 SELECT 没啥意义）</li><li><code>SAVEPOINT &lt;保留点></code> 和 <code>ROLLBACK TO &lt;保留点></code>：同样只能用在 <code>START TRANSACTION</code> 和 <code>COMMIT</code> 之间，其优势在于，<code>ROLLBACK TO</code> 可以指定回滚到某特定保留点，更灵活，而 <code>ROLLBACK</code> 只能回滚到事务开始前。</li></ul><p>需要注意的有：</p><ol><li><code>COMMIT</code> 和 <code>ROLLBACK</code> 语句也是事务的结束，因此如果执行了 <code>ROLLBACK</code>，那它与 <code>COMMIT</code> 之间的内容会被跳过。（在这一点上，它相当于大多数 PL 的 return）</li><li><strong>如果事务执行出现问题，问题行后面的所有语句都不会被执行！包括 <code>COMMIT</code> 和 <code>ROLLBACK</code></strong>！ 如果想用纯 SQL 实现事务原子性，必须使用存储过程检查执行状态！举例如下：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CREATE PROCEDURE my_test()
</span></span><span class=line><span class=cl>    BEGIN
</span></span><span class=line><span class=cl>        DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK  -- 检测到 SQLEXCEPTION 则 rollback，然后 exit
</span></span><span class=line><span class=cl>        START TRANSACTION
</span></span><span class=line><span class=cl>            INSERT INTO table_test VALUES(1, &#39;A&#39;)
</span></span><span class=line><span class=cl>            INSERT INTO table_test VALUES(1, &#39;B&#39;)  -- 这里主键冲突，会触发 SQLEXCEPTION
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            COMMIT
</span></span><span class=line><span class=cl>    END
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CALL my_test()
</span></span></code></pre></td></tr></table></div></div><p>或者<strong>在 PL 中通过异常处理执行 <code>ROLLBACK</code></strong>。（事务虽然中止了，但并未结束！所以仍然可以 <code>ROLLBACK</code> 或者 <code>COMMIT</code>）</p><h3 id=数据何时被提交到数据库 class=headerLink><a href=#%e6%95%b0%e6%8d%ae%e4%bd%95%e6%97%b6%e8%a2%ab%e6%8f%90%e4%ba%a4%e5%88%b0%e6%95%b0%e6%8d%ae%e5%ba%93 class=header-mark></a>数据何时被提交到数据库</h3><ol><li>显式提交：在事务中使用 <code>COMMIT</code> 提交数据操作被称为显式提交</li><li>隐式提交：非 DML 操作会被立即提交，也就是说这些语句本身就隐含了提交语义</li><li>自动提交： 如果 <code>AUTOCOMMIT</code> 被设置为 <code>ON</code>，当前 session 中的 DML 语句会在执行后被自动提交（<code>START TRANSACTION</code> 内部的 DML 除外，在它内部必须显式 <code>COMMIT</code>）</li></ol><p>所有的 DML 语句都是要显式提交的，MySQL session 的 <code>AUTOCOMMIT</code> 默认为 <code>ON</code>，所以 DML 会被自动提交。</p><blockquote><p>P.S. 许多语言的数据库 API 会定义自己的事务操作，不一定与这里一致。</p></blockquote></div><h2>相关内容</h2><div class=related-container><div class=related-item-container><div class=related-image><a href=/posts/consistency-and-consensus-algorithm/><img loading=lazy src=/posts/consistency-and-consensus-algorithm/featured-image.webp srcset="/posts/consistency-and-consensus-algorithm/featured-image.webp, /posts/consistency-and-consensus-algorithm/featured-image.webp 1.5x, /posts/consistency-and-consensus-algorithm/featured-image.webp 2x" sizes=auto alt=/posts/consistency-and-consensus-algorithm/featured-image.webp title=/posts/consistency-and-consensus-algorithm/featured-image.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/consistency-and-consensus-algorithm/>分布式数据库的一致性问题与共识算法</a></h2></div><div class=related-item-container><div class=related-image><a href=/posts/sqlalchemy-notes-3-relationship-and-foreignkey/><img loading=lazy src=/posts/sqlalchemy-notes-3-relationship-and-foreignkey/sqlalchemy-relationships.webp srcset="/posts/sqlalchemy-notes-3-relationship-and-foreignkey/sqlalchemy-relationships.webp, /posts/sqlalchemy-notes-3-relationship-and-foreignkey/sqlalchemy-relationships.webp 1.5x, /posts/sqlalchemy-notes-3-relationship-and-foreignkey/sqlalchemy-relationships.webp 2x" sizes=auto alt=/posts/sqlalchemy-notes-3-relationship-and-foreignkey/sqlalchemy-relationships.webp title=/posts/sqlalchemy-notes-3-relationship-and-foreignkey/sqlalchemy-relationships.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/sqlalchemy-notes-3-relationship-and-foreignkey/>SQLAlchemy 学习笔记（三）：ORM 中的关系构建</a></h2></div><div class=related-item-container><div class=related-image><a href=/posts/sqlalchemy-notes-2-orm-basics/><img loading=lazy src=/posts/sqlalchemy-notes-2-orm-basics/sqlalchemy-models.webp srcset="/posts/sqlalchemy-notes-2-orm-basics/sqlalchemy-models.webp, /posts/sqlalchemy-notes-2-orm-basics/sqlalchemy-models.webp 1.5x, /posts/sqlalchemy-notes-2-orm-basics/sqlalchemy-models.webp 2x" sizes=auto alt=/posts/sqlalchemy-notes-2-orm-basics/sqlalchemy-models.webp title=/posts/sqlalchemy-notes-2-orm-basics/sqlalchemy-models.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/sqlalchemy-notes-2-orm-basics/>SQLAlchemy 学习笔记（二）：ORM 基础</a></h2></div></div><div class=sponsor><div class=sponsor-avatar><img loading=lazy src=https://thiscute.world/avatar/myself.webp srcset="https://thiscute.world/avatar/myself.webp, https://thiscute.world/avatar/myself.webp 1.5x, https://thiscute.world/avatar/myself.webp 2x" sizes=auto alt=https://thiscute.world/avatar/myself.webp title=https://thiscute.world/avatar/myself.webp></div><p class=sponsor-bio><em>如果你觉得这篇文章对你有所帮助，欢迎赞赏~</em></p><a href=https://afdian.net/a/ryan4yin title=Sponsor target=_blank class=sponsor-button rel="noopener noreferrer"><i class="far fa-heart fa-fw icon" style=color:#ec6cb9></i>
<span>赞赏</span></a></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2018-06-15</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><button title="分享到 Twitter" data-sharer=twitter data-url=https://thiscute.world/posts/sql-basics-1/ data-title="SQL 基础笔记（一）" data-via=ryan4yin data-hashtags=SQL,数据库,Database><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Hacker News" data-sharer=hackernews data-url=https://thiscute.world/posts/sql-basics-1/ data-title="SQL 基础笔记（一）"><span class="fab fa-hacker-news fa-fw"></span></button><button title="分享到 Reddit" data-sharer=reddit data-url=https://thiscute.world/posts/sql-basics-1/><span class="fab fa-reddit fa-fw"></span></button><script>function shareOnMastodon(e,t){const o="share_mastodon_domain",i=localStorage.getItem(o)??"mastodon.social",n=prompt("Enter your Mastodon domain",i);if(n===null)return;localStorage.setItem(o,n);const a=e+`

`+t,s=new URL("https://"+n);s.pathname="share",s.searchParams.append("text",a),window.open(s,"_blank","width=500,height=500,left=500,toolbar=0,status=0")}</script>
<button title="分享到 Mastodon" onclick='shareOnMastodon("SQL 基础笔记（一）","https://thiscute.world/posts/sql-basics-1/")'><span class="fab fa-mastodon fa-fw"></span></button></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/sql/>SQL</a>,&nbsp;<a href=/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a>,&nbsp;<a href=/tags/database/>Database</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/video2chars-2/ class=prev rel=prev title="Python 视频转字符动画（二）进阶"><i class="fas fa-angle-left fa-fw"></i>Python 视频转字符动画（二）进阶</a>
<a href=/posts/sql-basics-2-queries/ class=next rel=next title="SQL 基础笔记（二）进阶查询">SQL 基础笔记（二）进阶查询<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><a href=https://www.foreverblog.cn/ target=_blank><img src=https://img.foreverblog.cn/logo_en_default.png alt style=display:inline-block;width:auto;height:20px></a>
<a href=https://www.foreverblog.cn/go.html target=_blank><img src=https://img.foreverblog.cn/wormhole_3.gif alt style=display:inline-block;width:auto;height:20px title=穿梭虫洞-随机访问十年之约友链博客></a></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.110.0">Hugo</a> 强力驱动&nbsp;|&nbsp;托管在 <a title=Vercel href=https://vercel.com/ target=_blank rel="noopener noreffer">Vercel</a> 上&nbsp;|&nbsp;主题 - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://thiscute.world/ target=_blank rel="noopener noreferrer">ryan4yin</a></span>&nbsp;|&nbsp;<span class=license> <a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:30},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"",lightTheme:"github-light",repo:"ryan4yin/thiscute.world"}},data:{"desktop-header-typeit":"This Cute World","mobile-header-typeit":"This Cute World"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"747LJ10EI7",algoliaIndex:"ryan-space",algoliaSearchKey:"658db5f2bf056f83458cacf5dd58ec80",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},sharerjs:!0,typeit:{cursorChar:null,cursorSpeed:null,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:null,speed:null}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/utterances.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4V93QVSNFW",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-4V93QVSNFW" async></script></div></body></html>